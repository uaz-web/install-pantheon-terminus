name: 'Install Pantheon Terminus'
description: "Install Terminus, Pantheon's CLI tool."
on:
  workflow_call:
    inputs:
      terminus-version:
        description: 'A specific version of Terminus to install. (x.y.z)'
        default: '3.0.7'
        required: false
        type: string
      pantheon-machine-token:
        description: 'A machine token for Terminus generated by Pantheon.'
        required: true
        type: string
runs:
  using: "composite"
  steps:
    - name: Setup PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: '7.4'
    - name: Download and install Terminus
      run: |
        mkdir -p ~/terminus && cd ~/terminus
        curl -L https://github.com/pantheon-systems/terminus/releases/download/"${{ inputs.terminus-version }}"/terminus.phar --output terminus
        chmod +x terminus
        sudo ln -s ~/terminus/terminus /usr/local/bin/terminus
        echo "terminus-version: ${{ inputs.terminus-version }}"
      shell: bash
    - name: Authenticate with Pantheon machine token
      run: terminus auth:login --machine-token="${{ inputs.pantheon-machine-token }}"
      shell: bash
